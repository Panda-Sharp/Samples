name: Update Folder To Gh-pages
# This workflow is triggered on push to the repository.
on: [push]

jobs:   
  clone_and_push:
    runs-on: windows-latest
    name: Clone And Push
    steps:
    - uses: actions/checkout@v1   
    
    - name: Git Config email
      run: git config --global user.email "emiliano84@github.com"
    - name: Git Config name
      run: git config --global user.name "DocFx Bot"
    - name: Git Config remote.origin.url
      run: git config --global remote.origin.url "https://emiliano84:${{secrets.GITHUB_TOKEN}}@github.com/emiliano84/myRepo.git"
      # https://stackoverflow.com/questions/5343068/is-there-a-way-to-cache-github-credentials-for-pushing-commits
        
    - name: git remote add origin
      run: git remote add origin https://github.com/emiliano84/myRepo
      # shell: bash
      # shell: powershell

    - name: git fetch origin
      run: git fetch origin

    - name: git checkout master
      run: git checkout master
      
    - name: git subtree add
      run: git subtree add --prefix docs origin/gh-pages  
      continue-on-error: true

    - name: Docfx
      id: docfx
      run: ".github/scripts/docfx.bat"
  #  docfx metadata docfx_project/docfx.json
  #  docfx build docfx_project/docfx.json -o docs

    - name: Git Add docs
      run: git add docs/* -f

    - name: Git Commit
      run: git commit -m "Docs"
      
    - name: Git Push
      run: git subtree push --prefix docs origin gh-pages
    
      # run: git push origin `git subtree split --prefix docs master`:gh-pages --force
      # run: git push https://emiliano84:${{secrets.GITHUB_TOKEN}}@github.com/emiliano84/Toolkit.Docs.git gh-pages --force 

    # - name: Git Subtree
    #   run: git subtree split --prefix docs -b gh-pages
 

    # - name: git reset --hard
    #   run: git reset --hard   
    # - name: Git delete branch
    #   run: git push https://emiliano84:${{secrets.GITHUB_TOKEN}}@github.com/emiliano84/Toolkit.Docs.git :gh-pages

    
    # - name: Git Push
    #   run: git push -f

  # job2:
  #   needs: job1
